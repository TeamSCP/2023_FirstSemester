3페이지
APK란 안드로이드 앱의 확장자로 앱을 설치하는 역할을 합니다. 
ZIP 파일 형식과 같고 인증을 위해 서명이 포함되어 있습니다.

4페이지
APK 파일 구성요소는 다음과 같습니다.
AndroidManifest.xml은 루트 디렉토리에 있고, 앱에 대한 필수 정보를 담고 있습니다. main Activity를 확인할 수 있는 파일이기 때문에 중요합니다.
META-INF 폴더는 인증서 파일들이 위치하고, classes.sec는 앱이 동작할 때 필요한 코드를 담고 있습니다.
lib는 라이브러리를 담고 있습니다.

5페이지
먼저, smali란 dalvik에서 사용하는 dex 형식의 어셈블리어 입니다.
dex 파일은 기계어로 되어 있어서 사람이 보기 힘드니까, 쉽게 읽을 수 있도록 smali code를 사용합니다. 안드로이드 리버싱과 코드 패치를 위해서는 꼭 알아야 합니다.

6페이지
실제 GINI Next라는 앱을 이용해 변조를 테스트 해보겠습니다.

7페이지
먼저 APK를 apktool.jar 파일을 이용해서 디컴파일 합니다.그러면 폴더가 생성되고, 그 안에 smali 라는 폴더가 생성됩니다.

8페이지
AndroidManifest.xml을 확인하고, 메인 액티비티를 확인합니다. 

9페이지
찾은 메인 액티비티를 찾아가서 smali 코드를 분석하고, 원하는 코드를 삽입할 수 있습니다. 해당 앱에서는 첫 화면에 뜨는 문자열을 바꿔보겠습니다.

10페이지
이후 변조된 smali를 apk로 리패키징을 진행합니다.

11페이지
이후 서명을 진행해야 하는데, 서명을 하기 위해 설치해야 할 과정을 정리했습니다.
먼저, jdk를 설치합니다.

12페이지
이후 그림과 같이 java 환경변수를 설정합니다.

13페이지
그림과 같이 시스템 변수 중 Path 변수에 아래 경로를 추가해주면 됩니다.

14페이지
keytool을 이용하여 서명할 키를 생성합니다.

15페이지
jarsigner를 이용하여 apk를 서명합니다. 이때 앞서 만든 keytool에서 만든 키를 사용합니다.

16페이지
변조된 앱을 다시 직접 설치해보고 실행시키면, 우리가 변조시킨 문자열이 뒤에 추가된 것을 확인할 수 있습니다. 이를 통해 안드로이드 앱 분석에 사용하거나, 임베디드 환경에서 앱을 변조하여 백도어를 실행시켜서 루팅할 수 있습니다.